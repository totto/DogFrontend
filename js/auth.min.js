var auth=function(){function e(){var e=window.location.search,n=c("tokenid");if(null!==n&&n.length>5)console.log("has cookie"),console.log(n);else if(e.indexOf("userticket=")>0){var r=e.substring(e.indexOf("=")+1),o=t(r,"ticket");i(o)?s(o):d()}else{if(!(e.indexOf("usertokenid=")>0))return d(),void 0;var a=e.substring(e.indexOf("=")+1),o=t(a,"token");i(o)?s(o):d()}}function t(e,t){var i=n(),o=r(i),a=g+"iam/"+o+"/getusertokenby"+t+"id",s=new XMLHttpRequest;return s.open("POST",a,!1),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.send("apptoken="+escape(i)+"&usertokenid="+e+"&ticketid="+e),s.responseText}function n(){var e=g+"logon/",t='<?xml version="1.0" encoding="UTF-8" standalone="yes"?><applicationcredential><params><applicationID>'+f+"</applicationID>"+"<applicationSecret>"+m+"</applicationSecret>"+"</params>"+"</applicationcredential>";t=escape(t);var n=new XMLHttpRequest;return n.open("POST",e,!1),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send("applicationcredential="+t),n.responseText}function r(e){var t=e.split("applicationtoken>")[1];return t=t.substring(0,t.length-2),console.log("appTokenId="+t),t}function i(e){for(var t=new DOMParser,n=t.parseFromString(e,"text/xml"),r=[],i=n.getElementsByTagName("role"),a=0;a<i.length;a++)r.push(i[a].getAttribute("name"));return o(r,h).length>0}function o(e,t){var n,r,i=[],o={},a=t.length;for(n=0;a>n;n++)o[t[n]]=!0;for(a=e.length,n=0;a>n;n++)r=e[n],r in o&&i.push(r);return i}function a(){var e=c("tokenid");return null!==e&&e.length>5?!0:!1}function s(e){var t=new DOMParser,n=t.parseFromString(e,"text/xml");tokenid=n.documentElement.getAttribute("id"),l("tokenid",tokenid,7),l("usertoken",e.replace(/(\r\n|\n|\r)/gm," "),7)}function u(){var e=c("usertoken"),t=new DOMParser,n=t.parseFromString(e,"text/xml"),r=n.getElementsByTagName("uid")[0].childNodes[0].nodeValue;return r}function l(e,t,n){if(n){var r=new Date;r.setTime(r.getTime()+1e3*60*60*24*n);var i="; expires="+r.toGMTString()}else var i="";document.cookie=e+"="+t+i+"; path=/"}function c(e){for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return null}function p(e){l(e,"",-1)}function d(){p("usertoken"),p("tokenid")}var g="/tokenservice/",f="Styrerommet",m="dummy",h=["Club Owner","WhydahUserAdmin"];return{authenticate:e,isAuthenticated:a,getUserName:u,logout:d}}();
